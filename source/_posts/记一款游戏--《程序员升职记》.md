title: 记一款游戏--《程序员升职记》
date: 2018-07-21 22:39:19
tags:
- 游戏
- 汇编
categories:
- 编程
thumbnail: http://p7tst3obo.bkt.clouddn.com/hrm/main.png?imageView2/0/interlace/1/q/100|watermark/2/text/Y3lhbmcudGVjaA==/font/Y29uc29sYXM=/fontsize/720/fill/I0Q0RUVGMQ==/dissolve/69/gravity/SouthEast/dx/10/dy/10
---

![main](http://p7tst3obo.bkt.clouddn.com/hrm/main.png?imageView2/0/interlace/1/q/100|watermark/2/text/Y3lhbmcudGVjaA==/font/Y29uc29sYXM=/fontsize/720/fill/I0Q0RUVGMQ==/dissolve/69/gravity/SouthEast/dx/10/dy/10)

最近在玩一款编程类的游戏，叫做《程序员升职记》，steam 平台只需￥36。通过组合几条非常基本的指令，例如加减、自加、自减、比较、跳转，实现一些小功能，例如简单的数值绝对值输出、两数乘法、阶乘运算、反转字符串等。游戏的本质是一款支持 11 条指令，最多支持 24 字节内存的 8 位 cpu 的运行。

![level](http://p7tst3obo.bkt.clouddn.com/hrm/level.png?imageView2/0/interlace/1/q/100|watermark/2/text/Y3lhbmcudGVjaA==/font/Y29uc29sYXM=/fontsize/720/fill/I0Q0RUVGMQ==/dissolve/69/gravity/SouthEast/dx/10/dy/10)

这款游戏前面的一些关卡主要在引导和介绍游戏，同时不断给出新的指令，开始只有简单的几条指令，后面会加入对内存的使用，间接寻址的使用，因此可以实现指针的操作。每一关都会给出随机的输入，经过你编写的程序后，算出符合要求的输出。编写程序的过程可以通过单步运行来调试，所以可以很快知道程序在哪里出错，并修改。

![asm](http://p7tst3obo.bkt.clouddn.com/hrm/asm.png?imageView2/0/interlace/1/q/100|watermark/2/text/Y3lhbmcudGVjaA==/font/Y29uc29sYXM=/fontsize/720/fill/I0Q0RUVGMQ==/dissolve/69/gravity/SouthEast/dx/10/dy/10)

这款游戏可以很好地帮助你理解 CPU 的运行原理，编写的程序其实就是汇编程序，每一条指令都可以对应到一条汇编指令。通过复制指令到记事本也可以看出。关卡的输入每一次都是随机出现的，这就要求程序要在任何合理的输入下都可以正确运行，而不是当前给定的输入。这款游戏又不像我之前玩过的另一款手机上的编程类游戏--light robot。这款游戏在指令的条数上没有任何限制，也就是说你可以使用不限数量的指令来实现你的程序，但另一方面游戏非常鼓励你找到一种最优解，使得指令条数和运算次数都尽可能的少，这意味着程序所需的代码空间很少，同时运算速度又最快。所以你可以先按照你对这个题目的解题思路来实现这个程序，等程序完美运行没有出错后，再来考虑怎么优化程序。light robot 是一款通过组合指令来实现不同的点灯效果的游戏，但是这个游戏是限制指令数量的，因此你不能先实现再进行优化，你必须一来就找到最优解，这让我在后面的关卡无法继续。

![light robot](http://p7tst3obo.bkt.clouddn.com/hrm/light-robot.png?imageView2/0/interlace/1/q/100|watermark/2/text/Y3lhbmcudGVjaA==/font/Y29uc29sYXM=/fontsize/720/fill/I0Q0RUVGMQ==/dissolve/69/gravity/SouthEast/dx/10/dy/10)

这款游戏还有一个特点就是支持单步调试，通过单步运行，可以很快看出运行出错的地方，结合指令，可以很快看出错误。在简单的测试没有出错之后，又可以全速运行程序，完成题目。因为所有的题目基本上都是需要通过跳转来实现循环结构的，这样可以实现不停的输入。而在你刚开始编写的程序中，很可能是没有考虑到所有情况的，可能这组输入运算正确，而到了下一组就不正确了。因此通过单步，中断运行，回退指令可以查看运算错误的原因，这和平常的开发也很像。

开头说了，这款游戏的解题过程其实就是一款简单 CPU 运行的过程。这款 CPU 最多支持11条指令，可以分为四类。第一类基本输入输出 input/output，第二类对内存的读写 copyfrom/copyto，第三类加减运算，包括加减一个数，和一个数自加一和自减一，第四类跳转指令，包括无条件跳转、值为零跳转、值为负跳转。第一类和第四类指令的运行不需要提供参数，指令的运行仅影响 CPU 寄存器或者仅受 CPU 寄存器的影响。而第二类和第三类的指令是需要提供一个参数的，刚开始这个参数是一个值，后面的关卡中加入了间接寻址，可以通过类似指针的操作来实现更多的功能，因此第二类和第三类指令的参数也支持地址参数。

![game](http://p7tst3obo.bkt.clouddn.com/hrm/game.png?imageView2/0/interlace/1/q/100|watermark/2/text/Y3lhbmcudGVjaA==/font/Y29uc29sYXM=/fontsize/720/fill/I0Q0RUVGMQ==/dissolve/69/gravity/SouthEast/dx/10/dy/10)

根据关卡的不同，可以用的内存大小（地毯数量）是不同的，最多的时候有 24 字节，有时候地毯上是有值的，类似于C语言中带初值的全局变量。对内存的使用主要是读写，而且不允许对一个空的内存执行读操作，因为此时该值是未知的。内存用来暂存一些程序运行时的中间数据。很多关卡都会在内存中给一个 0 值，因为 CPU 不支持立即寻址，因此将 0 值通过内存的方式给定，0 值经常被用于计数，因此你可能需要在程序的开始将其复制到另一块内存中，以确保下一次的输入还是可以拷贝一个 0，并从 0 开始计数。

这款游戏的编程语言是汇编，从程序执行结构上来说就只有两种，一种是顺序结构，另一种是选择结构，而循环结构则是需要通过选择结构和跳转指令来实现的。但由于跳转指令只有三条，带条件的只有值为零和值为负两种，也就是说在做某些题是需要判断值为正的，则需要进行对应的转换。在后面的关卡中，出现的题目比较复杂，需要采用子程序的设计来实现，类似于函数的概念。有一关里面甚至给出了一小段程序。

这款游戏的关卡不是很多，通关也不会花费很长的时间，但是程序给出了一个最优解的标准，对指令数量和运行次数的最大值给以限制，想要每一关都可以实现最优解也是需要费一番功夫的。另外游戏本身是有一条故事线的，虽然关系并不大，但是聊胜于无。
