title: 制作字库（Bin文件合并 C2BIN）
date: 2017/4/6 20:05:23
tags:
- C
- 嵌入式
- 字库
categories:
- 嵌入式
---

![这里写图片描述](http://p7tst3obo.bkt.clouddn.com/20170406200057751?imageView2/0/interlace/1/q/100|watermark/2/text/Y3lhbmcudGVjaA==/font/Y29uc29sYXM=/fontsize/720/fill/I0Q0RUVGMQ==/dissolve/69/gravity/SouthEast/dx/10/dy/10)

## 一、点阵文件生成

<!-- more -->

- 1、使用点阵字库生成器生成文字的点阵信息，采用 UNICODE 编码批量生成。

![这里写图片描述](http://p7tst3obo.bkt.clouddn.com/20170406200021005?imageView2/0/interlace/1/q/100|watermark/2/text/Y3lhbmcudGVjaA==/font/Y29uc29sYXM=/fontsize/720/fill/I0Q0RUVGMQ==/dissolve/69/gravity/SouthEast/dx/10/dy/10)

- 2、如果具有 C 文件的字库，例如 STM32 开发板的库函数 `x:\en.stm32cubef4\STM32Cube_FW_F4_V1.14.0\Utilities\Fonts` 中的字库 C 文件，可以使用 C2B转换助手，这个软件可以将 C 文件中的字符数组信息转换成 bin 文件。结果如下图所示：
![这里写图片描述](http://p7tst3obo.bkt.clouddn.com/20170406200057751?imageView2/0/interlace/1/q/100|watermark/2/text/Y3lhbmcudGVjaA==/font/Y29uc29sYXM=/fontsize/720/fill/I0Q0RUVGMQ==/dissolve/69/gravity/SouthEast/dx/10/dy/10)
使用时，尽量将开头无关的注释删除，但不要多删，保证 C 语言数组的正确。

## 二、BIN 文件合并

- 1、由于使用点阵字库生成器时，只用 UNICODE 编码才可以批量生成，在只需要显示英文，中文和常见的符号时，一般只需取 UNICODE 中的如下范围即可，
    ```
    0x0000~0x007F  向下兼容ASCII，取得英文和常见符号

    0x4E00~0x9FFF  中文常见字 
    ```

- 2、因此，生成的字库文件一般有两个文件，此时，需要使用二进制文件合并工具 UBIN 来就将两个文件合并成一个文件，便于烧录。关于这个软件的使用，可看[百度教程](http://jingyan.baidu.com/article/e2284b2b5b23e5e2e6118db8.html)。

- 3、在合并文件时，两个文件中见可以有一定的空余间隙，这只需要修改偏移量。勾选插入，设置一个大于第一个文件大小的绝对地址。
![这里写图片描述](http://p7tst3obo.bkt.clouddn.com/20170406200306752?imageView2/0/interlace/1/q/100|watermark/2/text/Y3lhbmcudGVjaA==/font/Y29uc29sYXM=/fontsize/720/fill/I0Q0RUVGMQ==/dissolve/69/gravity/SouthEast/dx/10/dy/10)

## 三、检验字库信息

- 1、若使用 C2BIN 软件，需要首先确认这个步骤生成的字库信息是正确的。一般看前后的数据是否正确，还有文件生成的大小。例如，C 文件中，一个字符使用 3x24 共 72 个字节来表示，共有 95 个字符，则生成后的 bin 文件的末地址应为 95*72-1 = 6839 = 1AB7h。使用 UltraEdit 打开 bin 文件，看下文件大小是否符合。

- 2、合并两个字库的 bin 文件后，一般先查看下由于偏移而产生的地址上的数据是否为 0x00，之后再将两个文件的大小相加后与合并文件的大小比较，看是否一致。之后再简单比较下文件开头和结束的数据是否一致就可以确认数据的正确性了。注意，这里的文件大小并不是系统显示的文件占用空间或大小，而是使用 UltraEdit 之类的软件打开文件后查看文件的末尾地址。